<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>

<style>

tr {
	padding: 4px !important;
}
.aside-ams-patient{
	width: 196px;
	border-radius: 16px 0px 0px 16px;
	background: var(--bg-02, #DBF2F4);
	height: 56px;
	border-right: 4px solid var(--ci-01, #0ABAB5);
	margin-left: 4px;
	color: var(--ci-01, #0ABAB5);
}

.search{
	width: 565px;
	height: 48px;
}

hr{
	margin: -8px 0 16px -16px;
	background: var(--border, #EBEFF0);
	height: 1px;
}

.dduk-row {
	gap: 16px;
}

#searchPatientBtn {
	background-color: transparent;
    position: absolute;
    top: 906px;
    left: 510px;
}

.autocomplete {
	position: absolute;
}

.autocomplete > div.active {
  background: #e0e5f6;
  color: #000;
}

.autocomplete > div {
  background: #f1f3f499;
  padding: .2rem .6rem;
}

/* 인사과 회원 관리 목록 */
.emp-list {
	width: 600px;
}

.empState-btn {
	width:76px;
	height:30px;
	margin-right:50px;
}

</style>
<!-- 승인 목록 창 -->
<div class="dduk-body-border patient-list emp-list ">
	<div>
		<div class="dduk-title-area">
			<h2>승인 목록</h2>
			<br/>
			<div class="dduk-row">
				<div class="inner-tab" id="inner-tab-11" style="border-bottom: 3px solid var(--ci-01, #0ABAB5);">
					<h3>대기</h3>
				</div>
				<div class="inner-tab" id="inner-tab-12" >
					<h3>완료</h3>
				</div>
			</div>
		</div>
		<!-- 대기 목록 창 시작    -->
		<div class="dduk-x-pd8  waitingEmp" style="max-height: 650px; overflow-y: scroll;">
			<table class="patient-list-table" id="patient-list-table">
				<thead>
					<tr class="tr-padding emps-list-cont">
						<th class="td-padding gray-text" style="width:30%">사번</th>
						<th class="td-padding gray-text paName" style="width:20%">이름</th>
						<th class="td-padding gray-text" style="width:30%">직무</th>
						<th class="td-padding gray-text" style="width:30%">상태</th>
					</tr>
				</thead>
				<tbody id="patientTbody" >
					<c:forEach var="emps" items="${employeeVOList}">
						<c:if test="${emps.empAcntState eq 'ACST01'}">
							<tr class="tr-padding tr-paInfo emps-list-cont" data-pano="PA0001">
								<td class="td-padding">${emps.empNo}</td>
								<td class="td-padding" >${emps.empName}</td>
								<td class="td-padding">${emps.empDeptNm}</td>
								<td class="td-padding">
					                <button class="dduk-btn-info btn-state empState-btn" >승인 대기</button>
								</td>
							</tr>
						</c:if>
					</c:forEach>
				</tbody>
			</table>
		</div>
		<!-- 대기 목록 창 끝    -->
		<!-- 완료 목록 창 시작    -->
		<div class="dduk-x-pd8  permittedEmp" style="max-height: 700px; overflow-y: scroll; display: none;">
			<table class="patient-list-table" id="patient-list-table">
				<thead>
					<tr class="tr-padding emps-list-cont">
						<th class="td-padding gray-text" style="width:30%">사번</th>
						<th class="td-padding gray-text paName" style="width:20%">이름</th>
						<th class="td-padding gray-text" style="width:30%">직무</th>
						<th class="td-padding gray-text" style="width:30%">상태</th>
					</tr>
				</thead>
				<tbody id="patientTbody" class="perEmp">
					<c:forEach var="emps" items="${employeeVOList}">
						<c:if test="${emps.empAcntState eq 'ACST02'}">
							<tr class="tr-padding tr-paInfo emps-list-cont" data-pano="PA0001">
								<td class="td-padding">${emps.empNo}</td>
								<td class="td-padding" >${emps.empName}</td>
								<td class="td-padding">${emps.empDeptNm}</td>
								<td class="td-padding">
					                <button class="dduk-btn-disabled btn-state empState-btn" >승인</button>
								</td>
							</tr>
						</c:if>
					</c:forEach>
				</tbody>
			</table>
		</div>
		<!-- 완료 목록 창 끝    -->
	</div>
	<input id="searchPatient" class="search dduck-input" placeholder="사원 이름을 검색해주세요">
		<button id="searchPatientBtn" style="margin-left:250px;">
			<img src="/resources/images/Search.png">
		</button>
	<div class="autocomplete"></div>
</div>
<div class="dduk-body-border patient-list emp-list ">
	<div>
		<div class="dduk-title-area">
			<h2>사원 목록</h2>
			<br/>
			<div class="dduk-row">
				<div class="inner-tab" id="inner-tab-21" style="border-bottom: 3px solid var(--ci-01, #0ABAB5);">
					<h3>전체</h3>
				</div>
				<div class="inner-tab" id="inner-tab-22" >
					<h3>잠김</h3>
				</div>
				<div class="inner-tab" id="inner-tab-23" >
					<h3>퇴사</h3>
				</div>
			</div>
		</div>
		<!-- 전체 목록 창 시작   -->
		<div class="dduk-x-pd8 wholeEmp" style="max-height: 600px; overflow-y: scroll;">
			<table class="patient-list-table" id="patient-list-table">
				<thead>
					<tr class="tr-padding emps-list-cont">
						<th class="td-padding gray-text" style="width:30%">사번</th>
						<th class="td-padding gray-text paName" style="width:20%">이름</th>
						<th class="td-padding gray-text" style="width:30%">직무</th>
						<th class="td-padding gray-text" style="width:30%">상태</th>
					</tr>
				</thead>
				<tbody id="patientTbody">
					<c:forEach var="emps" items="${employeeVOList}">
						<tr class="tr-padding tr-paInfo emps-list-cont" data-pano="PA0001">
							<td class="td-padding">${emps.empNo}</td>
							<td class="td-padding" >${emps.empName}</td>
							<td class="td-padding">${emps.empDeptNm}</td>
							<td class="td-padding">
								<c:choose> 
									<c:when test="${emps.empAcntState eq 'ACST01'}">
										<button class="dduk-btn-info btn-state empState-btn" >승인 대기</button>
									</c:when> 
									<c:when test="${emps.empAcntState eq 'ACST02'}">
						                <button class="dduk-btn-disabled btn-state empState-btn" >승인</button>
									</c:when>
									<c:when test="${emps.empAcntState eq 'ACST03'}">
										<button class="dduk-btn-danger btn-state empState-btn" >잠김</button>
									</c:when> 
									<c:otherwise>
						                <button class="dduk-btn-danger btn-state empState-btn" >퇴사</button>
									</c:otherwise> 
								</c:choose> 
							</td>
						</tr>
					</c:forEach>
				</tbody>
			</table>
		</div>
		<!-- 전체 목록 창 끝   -->
		<!-- 잠김 목록 창 시작   -->
		<div class="dduk-x-pd8 lockedEmp" style="max-height: 700px; overflow-y: scroll; display: none;">
			<table class="patient-list-table" id="patient-list-table">
				<thead>
					<tr class="tr-padding emps-list-cont">
						<th class="td-padding gray-text" style="width:30%">사번</th>
						<th class="td-padding gray-text paName" style="width:20%">이름</th>
						<th class="td-padding gray-text" style="width:30%">직무</th>
						<th class="td-padding gray-text" style="width:30%">상태</th>
					</tr>
				</thead>
				<tbody id="patientTbody">
					<c:forEach var="emps" items="${employeeVOList}">
						<c:if test="${emps.empAcntState eq 'ACST03'}">
							<tr class="tr-padding tr-paInfo emps-list-cont" data-pano="PA0001">
								<td class="td-padding">${emps.empNo}</td>
								<td class="td-padding" >${emps.empName}</td>
								<td class="td-padding">${emps.empDeptNm}</td>
								<td class="td-padding">
					                <button class="dduk-btn-danger btn-state empState-btn" >잠김</button>
								</td>
							</tr>
						</c:if>
					</c:forEach>
				</tbody>
			</table>
		</div>
		<!-- 잠김 목록 창 끝   -->
		<!-- 퇴사 목록 창 시작   -->
		<div class="dduk-x-pd8 outEmp" style="max-height: 700px; overflow-y: scroll; display: none;">
			<table class="patient-list-table" id="patient-list-table">
				<thead>
					<tr class="tr-padding emps-list-cont">
						<th class="td-padding gray-text" style="width:30%">사번</th>
						<th class="td-padding gray-text paName" style="width:20%">이름</th>
						<th class="td-padding gray-text" style="width:30%">직무</th>
						<th class="td-padding gray-text" style="width:30%">상태</th>
					</tr>
				</thead>
				<tbody id="patientTbody">
					<c:forEach var="emps" items="${employeeVOList}">
						<c:if test="${emps.empAcntState eq 'ACST04'}">
							<tr class="tr-padding tr-paInfo emps-list-cont" data-pano="PA0001">
								<td class="td-padding">${emps.empNo}</td>
								<td class="td-padding" >${emps.empName}</td>
								<td class="td-padding">${emps.empDeptNm}</td>
								<td class="td-padding">
					                <button class="dduk-btn-danger btn-state empState-btn" >퇴사</button>
								</td>
							</tr>
						</c:if>
					</c:forEach>
				</tbody>
			</table>
		</div>
		<!-- 퇴사 목록 창 끝   -->
	</div>
	<input id="searchPatient" class="search dduck-input" placeholder="사원 이름을 검색해주세요">
		<button id="searchPatientBtn" style="margin-left:870px;"">
			<img src="/resources/images/Search.png">
		</button>
	<div class="autocomplete"></div>
</div>

<script>
// 검색 기능
var dataList = [];

const $search = document.querySelector("#search");
const $autoComplete = document.querySelector(".autocomplete");

let nowIndex = 0;

$search.onkeyup = (event) => {
  // 검색어
  const value = $search.value.trim();

  // 자동완성 필터링
  const matchDataList = value
    ? dataList.filter((label) => label.includes(value))
    : [];

  switch (event.keyCode) {
    // UP KEY
    case 38:
      nowIndex = Math.max(nowIndex - 1, 0);
      break;

    // DOWN KEY
    case 40:
      nowIndex = Math.min(nowIndex + 1, matchDataList.length - 1);
      break;

    // ENTER KEY
    case 13:
      document.querySelector("#search").value = matchDataList[nowIndex].match(/[ㄱ-ㅎㅏ-ㅣ가-힣]+/g).join(" ") || "";
	  var patientId = matchDataList[nowIndex].substring(0,6);
	  console.log(patientId);
	  searchPatientByNo(patientId);
	  $("#rsvtYN").val("RCTY01");
      // 초기화
      nowIndex = 0;
      matchDataList.length = 0;
      break;
      
    // 그외 다시 초기화
    default:
      nowIndex = 0;
      break;
  }

  // 리스트 보여주기
  showList(matchDataList, value, nowIndex);
};

const showList = (data, value, nowIndex) => {
  // 정규식으로 변환
  const regex = new RegExp("(" + value + ")", "g");
  
  $autoComplete.innerHTML = data
  .map(function(label, index) {
    return "<div class='" + (nowIndex === index ? "active" : "") + "'>" +
      label.replace(regex, "<mark>$1</mark>") +
      "</div>";
  })
  .join("");
};

$(function(){
	// 승인 목록창
	// 대기 버튼을 누르면 완료가 사라짐
	 $('#inner-tab-11').click(function(){
		$('.waitingEmp').css('display', 'block');
		$('.permittedEmp').css('display', 'none');
		$('#inner-tab-11').attr('style', 'border-bottom: 3px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-12').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
	 });
	 // 완료 버튼을 누르면 대기가 사라짐
	 $('#inner-tab-12').click(function(){
		$('.permittedEmp').css('display', 'block');
		$('.waitingEmp').css('display', 'none');
		$('#inner-tab-12').attr('style', 'border-bottom: 3px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-11').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
	 });
	 
	 // 사원 목록창	
	 // 전체 버튼을 누르면 잠김, 퇴사가 사라짐
	 $('#inner-tab-21').click(function(){
		$('.wholeEmp').css('display', 'block');
		$('.lockedEmp').css('display', 'none');
		$('.outEmp').css('display', 'none');
		$('#inner-tab-21').attr('style', 'border-bottom: 3px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-22').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-23').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
	 });
	 // 잠김 버튼을 누르면 전체, 퇴사가 사라짐
	 $('#inner-tab-22').click(function(){
		$('.wholeEmp').css('display', 'none');
		$('.lockedEmp').css('display', 'block');
		$('.outEmp').css('display', 'none');
		$('#inner-tab-22').attr('style', 'border-bottom: 3px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-21').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-23').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
	 });
	// 퇴사 버튼을 누르면 전체, 잠김이 사라짐
	 $('#inner-tab-23').click(function(){
		$('.wholeEmp').css('display', 'none');
		$('.lockedEmp').css('display', 'none');
		$('.outEmp').css('display', 'block');
		$('#inner-tab-23').attr('style', 'border-bottom: 3px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-21').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab-22').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
	 });
	
});
</script>